# LuNA Language Support (VS Code)

Расширение для Visual Studio Code, предназначенное для работы с языком **LuNA** (`.fa`) и связанным с ним файлом **ucodes.cpp**. Расширение разработано в рамках учебного проекта и ориентировано на использование в среде разработки VS Code.



## Назначение

Расширение предоставляет базовую поддержку языка LuNA, а также опциональный AI-ассистент для анализа кода и работы с документацией. Основная цель проекта — интеграция инструментов анализа и помощи в программировании непосредственно в редактор, без необходимости использования внешних средств.



## Основные возможности

Расширение полностью работоспособно **без использования AI**. Все перечисленные ниже функции доступны по умолчанию.

### Поддержка языка LuNA

1. **Подсветка синтаксиса** для файлов `.fa`.
2. **Автодополнение**:
   * ключевые слова языка LuNA (`sub`, `df`, `cf`, `request`, `delete`, и др.);
   * сниппеты для типовых конструкций (`cf`, `sub`, блок рекомендаций `@ { ... }`).
3. **Language Server Protocol (LSP)**:
   * статический анализ и диагностики для файлов `.fa`;
   * анализ файла `ucodes.cpp`, расположенного рядом с `.fa`, независимо от того, открыт ли он во вкладке редактора;
   * устранение ложных предупреждений о несуществующих функциях до открытия `ucodes.cpp`.
4. **Подсказка о создании `ucodes.cpp`**, если файл отсутствует в проекте.



## AI‑ассистент LuNA (опционально)

При включении ассистент интегрируется в интерфейс VS Code и используется через отдельную панель чата. Ассистент не является обязательной частью расширения и может быть полностью отключён.

### Возможности ассистента

* анализ кода текущего файла или выделенного фрагмента без ручного копирования текста;
* обработка запросов вида:
  * «в текущем файле объясни, что делает код»;
  * «в выделенном фрагменте найти ошибку»;
* ответы отображаются в чате ассистента;
* поддержка последовательного диалога по одному и тому же фрагменту кода.

При формировании запроса ассистент автоматически использует:
- текст активного файла или выделения;
- язык документа;
- относительный путь к файлу.

Контекст редактора сохраняется даже при переносе фокуса в окно чата.


## База знаний и RAG

Ассистент может быть использован совместно с базой знаний LuNA:

* документация синхронизируется из **Yandex Object Storage**;
* локально строится индекс по текстовым файлам (Markdown, TXT);
* ответы формируются строго на основе найденных фрагментов (подход RAG).

Индексация и хранение выполняются локально, без передачи пользовательского кода во внешние хранилища.



## Быстрый старт

1. Установите расширение в VS Code.
2. Откройте проект, содержащий файлы `.fa`.
3. Подсветка, автодополнение и диагностики будут включены автоматически.

AI‑ассистент по умолчанию отключён и не влияет на базовую функциональность.



## Включение AI‑ассистента

1. В настройках VS Code включите параметр:
   * `luna.assistant.enabled`
2. Выполните команду:
   * **LuNA: Set Yandex API Key**
3. При необходимости выполните:
   * **LuNA: Reindex Knowledge Base for Assistant**
4. Откройте панель:
   * **LuNA: Open AI Assistant**



## Использование ассистента

### Через чат

Примеры запросов:

* `в текущем файле объясни, что делает код`
* `в выделении предложи рефакторинг`

### Через команды редактора

* **LuNA: Explain File** — отправляет код текущего файла в чат ассистента и формирует запрос на его объяснение.



## Настройка Yandex AI Studio

Для работы ассистента используется Yandex AI Studio API с аутентификацией по API‑ключу:

```
Authorization: Api-Key <API_key>
```

### Модели

Для построения эмбеддингов рекомендуется использовать:

* `emb://<folder_ID>/text-search-doc/latest`
* `emb://<folder_ID>/text-search-query/latest`

Для генерации ответов используется Text Generation API. URI модели задаётся параметром `luna.assistant.generationModelUri`.



## Настройка Object Storage

1. Создайте bucket в Yandex Object Storage.
2. Укажите в настройках расширения:
   * `luna.kb.storage.bucket`;
   * `luna.kb.storage.basePrefix` (по умолчанию `luna-kb`).
3. Выполните команду:
   * **LuNA KB: Set Storage Credentials**.

Управление версиями и документами доступно через боковую панель **LuNA → Knowledge Base**.



## Команды расширения

* `LuNA: Open AI Assistant`
* `LuNA: Explain File`
* `LuNA: Reindex Knowledge Base for Assistant`
* `LuNA: Toggle AI Assistant`
* `LuNA: Set Yandex API Key`



## Хранение данных

Индекс базы знаний хранится в `globalStorage` расширения и не размещается в проекте. Для каждой версии документации используется отдельный индекс.



## Сборка и разработка

```bash
npm install
npm run compile
```

